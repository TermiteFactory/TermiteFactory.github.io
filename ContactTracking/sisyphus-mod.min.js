!function(t){function e(t){return"[id="+t.attr("id")+"][name="+t.attr("name")+"]"}t.fn.sisyphus=function(i){var n=t.map(this,function(i){return e(t(i))}).join(),o=Sisyphus.getInstance(n);return o.protect(this,i),o};var i={isAvailable:function(){if("object"==typeof t.jStorage)return!0;try{return localStorage.getItem}catch(t){return!1}},set:function(e,i){if("object"==typeof t.jStorage)t.jStorage.set(e,i+"");else try{localStorage.setItem(e,i+"")}catch(t){}},get:function(e){if("object"==typeof t.jStorage){var i=t.jStorage.get(e);return i?i.toString():i}return localStorage.getItem(e)},remove:function(e){"object"==typeof t.jStorage?t.jStorage.deleteKey(e):localStorage.removeItem(e)}};Sisyphus=function(){var n={instantiated:[],started:[]},o=window.CKEDITOR;return{getInstance:function(a){return n.instantiated[a]||(n.instantiated[a]={setInstanceIdentifier:function(t){this.identifier=t},getInstanceIdentifier:function(){return this.identifier},setInitialOptions:function(e){this.options=this.options||t.extend({excludeFields:[],occludeFields:[],customKeySuffix:"",locationBased:!1,timeout:0,autoRelease:!0,onBeforeSave:function(){},onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}},e),this.browserStorage=i},setOptions:function(e){this.options=this.options||this.setInitialOptions(e),this.options=t.extend(this.options,e)},protect:function(e,i){this.setOptions(i),e=e||{};var a=this;if(this.targets=this.targets||[],a.options.name?this.href=a.options.name:this.href=location.hostname+location.pathname+location.search+location.hash,this.targets=t.merge(this.targets,e),this.targets=t.unique(this.targets),this.targets=t(this.targets),!this.browserStorage.isAvailable())return!1;var s=a.options.onBeforeRestore.call(a);if((void 0===s||s)&&a.restoreAllData(),this.options.autoRelease?a.bindReleaseData():a.bindSaveDataOnSubmit(),!n.started[this.getInstanceIdentifier()])if(a.isCKEditorPresent())var r=setInterval(function(){o.isLoaded&&(clearInterval(r),a.bindSaveData(),n.started[a.getInstanceIdentifier()]=!0)},100);else a.bindSaveData(),n.started[a.getInstanceIdentifier()]=!0},isCKEditorPresent:function(){return!!this.isCKEditorExists()&&(o.isLoaded=!1,o.on("instanceReady",function(){o.isLoaded=!0}),!0)},isCKEditorExists:function(){return void 0!==o},findFieldsToProtect:function(t){return t.find(":input").not(":submit").not(":reset").not(":button").not(":file").not(":password").not(":disabled").not("[readonly]")},bindSaveDataOnSubmit:function(){var i=this;i.targets.each(function(){var n=t(this),o=e(n);t(this).bind("submit",function(){i.saveOccludedData(o,i.findFieldsToProtect(n))})})},saveOccludedData:function(i,o){var a=this;n.started[a.getInstanceIdentifier()]=!1,o.each(function(){if(-1===t.inArray(this,a.options.occludeFields))return!0;var n=t(this),o=(a.options.locationBased?a.href:"")+i+e(n)+a.options.customKeySuffix;if(n.is(":text")||n.is("textarea")){for(var s="",r=0;r<n.val().length;r++)r<n.val().length/2?s+="*":s+=n.val().charAt(r);a.saveToBrowserStorage(o,s)}})},bindSaveData:function(){var i=this;i.options.timeout&&i.saveDataByTimeout(),i.targets.each(function(){var n=e(t(this));i.findFieldsToProtect(t(this)).each(function(){if(-1!==t.inArray(this,i.options.excludeFields))return!0;var o=t(this),a=(i.options.locationBased?i.href:"")+n+e(o)+i.options.customKeySuffix;if(o.is(":text")||o.is("textarea")){if(-1!==t.inArray(this,i.options.occludeFields))return!0;i.options.timeout||i.bindSaveDataImmediately(o,a)}i.bindSaveDataOnChange(o)})})},saveAllData:function(){var i=this;i.targets.each(function(){var n=e(t(this)),a={};i.findFieldsToProtect(t(this)).each(function(){var s=t(this);if(-1!==t.inArray(this,i.options.excludeFields)||void 0===s.attr("name")&&void 0===s.attr("id"))return!0;var r=(i.options.locationBased?i.href:"")+n+e(s)+i.options.customKeySuffix,c=s.val();if(s.is(":checkbox")){var d=s.attr("name");if(void 0!==d&&-1!==d.indexOf("[")){if(!0===a[d])return;c=[],t("[name='"+d+"']:checked").each(function(){c.push(t(this).val())}),a[d]=!0}else c=s.is(":checked");i.saveToBrowserStorage(r,c,!1)}else if(s.is(":radio"))s.is(":checked")?(c=s.val(),i.saveToBrowserStorage(r,c,!1)):i.browserStorage.remove(r);else{if(-1!==t.inArray(this,i.options.occludeFields))return!0;if(i.isCKEditorExists()){var u=o.instances[s.attr("name")]||o.instances[s.attr("id")];u?(u.updateElement(),i.saveToBrowserStorage(r,s.val(),!1)):i.saveToBrowserStorage(r,c,!1)}else i.saveToBrowserStorage(r,c,!1)}})}),i.options.onSave.call(i)},restoreAllData:function(){var i=this,n=!1;i.targets.each(function(){var o=t(this),a=e(t(this));i.findFieldsToProtect(o).each(function(){if(-1!==t.inArray(this,i.options.excludeFields))return!0;var o=t(this),s=(i.options.locationBased?i.href:"")+a+e(o)+i.options.customKeySuffix,r=i.browserStorage.get(s);null!==r&&(i.restoreFieldsData(o,r),n=!0,-1!==t.inArray(this,i.options.occludeFields)&&o.attr("readonly",""))})}),n&&i.options.onRestore.call(i)},restoreFieldsData:function(e,i){if(void 0===e.attr("name")&&void 0===e.attr("id"))return!1;var n=e.attr("name");!e.is(":checkbox")||"false"===i||void 0!==n&&-1!==n.indexOf("[")?!e.is(":checkbox")||"false"!==i||void 0!==n&&-1!==n.indexOf("[")?e.is(":radio")?e.val()===i&&e.prop("checked",!0):void 0===n||-1===n.indexOf("[")?e.val(t.trim(i)):(i=i.split(","),e.val(i)):e.prop("checked",!1):e.prop("checked",!0)},bindSaveDataImmediately:function(t,e){var i=this;if("onpropertychange"in t?t.get(0).onpropertychange=function(){i.saveToBrowserStorage(e,t.val())}:t.get(0).oninput=function(){i.saveToBrowserStorage(e,t.val())},this.isCKEditorExists()){var n=o.instances[t.attr("name")]||o.instances[t.attr("id")];n&&n.document.on("keyup",function(){n.updateElement(),i.saveToBrowserStorage(e,t.val())})}},saveToBrowserStorage:function(t,e,i){var n=this.options.onBeforeSave.call(this);void 0!==n&&!1===n||(i=void 0===i||i,this.browserStorage.set(t,e),i&&""!==e&&this.options.onSave.call(this))},bindSaveDataOnChange:function(t){var e=this;t.change(function(){e.saveAllData()})},saveDataByTimeout:function(){var t=this;t.targets,setTimeout(function e(){t.saveAllData(),setTimeout(e,1e3*t.options.timeout)},1e3*t.options.timeout)},bindReleaseData:function(){var i=this;i.targets.each(function(){var n=t(this),o=e(n);t(this).bind("submit reset",function(){i.releaseData(o,i.findFieldsToProtect(n))})})},manuallyReleaseData:function(){var i=this;i.targets.each(function(){var n=t(this),o=e(n);i.releaseData(o,i.findFieldsToProtect(n))})},releaseData:function(i,o){var a=!1,s=this;n.started[s.getInstanceIdentifier()]=!1,o.each(function(){if(-1!==t.inArray(this,s.options.excludeFields))return!0;var n=t(this),o=(s.options.locationBased?s.href:"")+i+e(n)+s.options.customKeySuffix;s.browserStorage.remove(o),a=!0}),a&&s.options.onRelease.call(s)}},n.instantiated[a].setInstanceIdentifier(a),n.instantiated[a].setInitialOptions()),n.instantiated[a]},free:function(){return n={instantiated:[],started:[]},null},version:"1.1.3"}}()}(jQuery);